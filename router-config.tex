\chapter{Router Configuration}
\section{Static Routing} Static routing is a
method of explicitly stating where a router should send its traffic for a given
network. Due to it's Administrative Distance of 1 a static route is chosen over
any other routing protocol, only being overruled if the router can see that the
destination address is on a local interface (directly connected). Once the BT
network began to adopt IS-IS as its interior gateway protocol (IGP) static
routes were removed in favour of dynamic routing, they were also removed from
the configurations to ensure that static routes were not erroneously chosen
over a IS-IS sourced counterpart.

\begin{lstlisting}[caption={Alpha Static Route}, label={listing:alpha-static}]
ip route 10.1.1.1 255.255.255.255 100.100.105.1
\end{lstlisting}

In the final topology of BT a single static route has remained in use, the
configuration of which is shown in Listing~\ref{listing:alpha-static}. This
route is used as a component of the eBGP peer link to Autonomous System No. 42,
this peering is sourced from a Loopback interface on the remote side, because
of this the local side requires a static route which provides initial
connectivity to this Loopback. Without the use of these static routes the BGP
sources on both sides would not be able to communicate and thus will never peer
with one- another.

\section{Interior Gateway Protocols}
Within the three-router layout it can be seen that all networks within the
topology has at least two paths to connect to any other network, due to this
fact it was decided that the use of static routing would not provide the fault-
tolerance that would be expected in an ISP network. To provide this additional
level of redundancy we opted to use an IGP to provide automatic routing within
the BT infrastructure. This routing is provided using Intermediate System -
Intermediate System (IS-IS), a link state protocol which computes the shortest
path between devices in the network using Dijkstra's Shortest Path Algorithm. We
have opted to use dynamic routings in BT's internal infrastructure due to its
reliability and fast convergence time when any issues arise within the network.

IS-IS is implemented using the Loopback interfaces defined on each router in the
network, from the IP Address of these Loopbacks we have defined a NET address
which represents the device in the IS-IS routing process. The NET is an NSAP
format which defines information about the device such as the Area ID and a
unique ID for the device in that Area. An example of the NET address for Alpha
is shown in Listing~\ref{listing:alpha-isis}, from this we can see that Alpha is
a member of Area 1, having an IP address of \texttt{12.1.1.1}.

\begin{lstlisting}[caption={Alpha IS-IS Configuration}, label={listing:alpha-isis}]
hostname Alpha
!
router isis
 net 49.0001.0120.0100.1001.00
 is-type level-1
 passive-interface FastEthernet0/0/1
\end{lstlisting}

In addition to the NET configuration, for IS-IS to include networks in its
routing table the network needs to be added on an interface-by-interface basis,
flagging the interface to be included in the routing table. This has been
implemented on all interfaces inside of BT on both IPv4 and IPv6. Once both the
routing process and the interfaces for routing has been defined on all devices
the IS-IS process runs the shortest path algorithm and selects the best routes
within the network. When connecting BT to other Autonomous Systems for BGP it
soon became apparent that other groups had opted for a similar NET address
schema as ourselves, this caused additional problems as routes from another
ISP's IS-IS process were being passed into the BT infrastructure. In order to
stop these routes from coming into the internal routing process passive
interfaces were configured on all external links, allowing the interface to
remain in the IS-IS routing table but preventing route updates from being sent
or received on that link.

\section{Exterior Gateway Protocols} In order for BGP to provide internet access
to their customers they must have a complete internet routing table from which
they can identify the best possible routes for their customer traffic to reach
its destination. In addition to the knowledge of internet routing table it must
also provide alternate paths to a destination should a route go offline or their
links become saturated with network traffic. In order to provide both of these
services an EGP must be used, the only EGP currently in use is the Border
Gateway Protocol (BGP). This external routing protocol allows Autonomous Systems
to interact with one-another through the exchange of prefixes (network
advertisements) or through traffic management in the form of BGP policy.

The implementation of BGP can be further broken down into two separate forms,
eBGP and iBGP. The first of these handles the peering and advertisements between
Autonomous Systems, facilitating the distribution of the BGP Prefix table and
the configuration of routing metrics on these prefixes in order to influence
routing decisions. In comparison, the iBGP process handles the propagation of
the prefix table throughout internal routers.

For BT's peering to other ISPs we have opted to take the approach of peering
with the source of a Loopback interface rather than the traditional method of
using the source interface of the connection. This decision was taken at an
early stage of the BGP peering process with the intention of introducing
redundant connections to peers or by implementing multi-hop peering to other
Autonomous Systems, however these plans were not implemented due to a lack of
time and physical interfaces on some routers. Implementation of these
connections required additional configuration on our Peer's network as they
would need to configure a static route on their device in order to connect to
our Loopback and begin the peering process. A snippet of our neighbour peering
configuration is shown in Listing~\ref{listing:sky-ebgp-conf}. It can be seen
that in addition to updating the source of the BGP process it was also necessary
to add a the command \texttt{disable-connected-check} which removes a test for
BGP peers to ensure that they are directly connected. However, from our
experiences in the lab we found that this command alone did not allow a peering
to form, the additional command \texttt{ebgp-multihop 2} was also required in
order for the peers to form correctly.

\begin{lstlisting}[caption={BT-Sky eBGP Configuration}, label={listing:sky-ebgp-conf}]
router bgp 2110
!
! Omitted
!
 neighbor 12.11.0.2 remote-as 5607
 neighbor 12.11.0.2 description PEER_TO_GROUP1
 neighbor 12.11.0.2 ebgp-multihop 2
 neighbor 12.11.0.2 disable-connected-check
 neighbor 12.11.0.2 update-source Loopback0
!
\end{lstlisting}

With regards to to the internal BGP, all three routers in the topology were
configured to distribute their eBGP routes to one-another through iBGP. These
internal peers were again formed on Loopback addresses as a countermeasure for
link failure between the routers tearing down peer relationships. The use of a
Loopback allows the peering to remain up after IS-IS converges, in comparison
using the interface address would cause the peering to fail as the IP address
would not be reachable after a link failure. A second command, \texttt{next-hop-
self} tells the local iBGP process to label any routes with their own address as
the next hop, without this command the next-hop on any routes will remain as the
next-hop for the sending router, this will cause connectivity issues. A snippet
of the iBGP peering configuration between Bravo and Alpha is shown in
Listing~\ref{listing:bravo-ibgp-conf}

\begin{lstlisting}[caption={Bravo-Alpha iBGP Configuration}, label={listing:bravo-ibgp-conf}]
router bgp 2110
 neighbor 12.1.1.1 remote-as 2110
 neighbor 12.1.1.1 update-source Loopback0
 neighbor 12.1.1.1 next-hop-self
\end{lstlisting}

The contents of the prefix table that is distributed by our AS is dependent on
the configured network statements under the BGP process. This allows us to
dictate which local BT networks we would like our peers to know about and
therefore allow their traffic to reach. In our configurations we decided that
the prefixes we sent should be as specific as possible and should not advertise
unnecessary sections of our network, such as internal point-to-point links. From
this decision we were able to narrow the advertised networks down to a list of
six unique prefixes which were of two groups, the first being the Customer
Segment networks which house webservers, DNS and our customers. The second
grouping is our router subnets, which would facilitate eBGP multihop peers which
were discussed earlier. The configuration for these network advertisements is
shown in Listing~\ref{listing:bravo-net-conf}

\begin{lstlisting}[caption={Bravo BGP Network Configuration}, label={listing:bravo-net-conf}]
router bgp 2110
 network 12.0.1.0 mask 255.255.255.0
 network 12.0.2.0 mask 255.255.255.0
 network 12.0.3.0 mask 255.255.255.0
 network 12.1.1.1 mask 255.255.255.255
 network 12.2.2.2 mask 255.255.255.255
 network 12.3.3.3 mask 255.255.255.255
\end{lstlisting}

\section{Security}
The first security measure we use is having a user account for every router and
laptop in our setup. For ease of use all users are called ``group''. This added
the first layer of security,  meaning a password was required to access the
devices.

For routers, a second ``enable'' password is present, this is used to enter
enable mode on the routers and set with the command \texttt{enable password
\#\#\#\#\#}. The command \texttt{service password-encryption} was then used to
encrypt the passwords so they do not appear in the router configuration files
in plaintext. It should be noted that \texttt{service password-encryption} uses
a weak form of encryption~\cite{ciscocracker}, mainly to avoid issues like
should-surfing for example. The alternate option would of been to use
\texttt{enable secret \#\#\#\#\#} instead which stores the password as an MD5
hash, however seeing as MD5 is fairly weak anyway~\cite{md5} we didn't feel it
would make much difference.

Additionally telnet is also disabled over router VTY lines. This was done
because telnet sends login information in plaintext, and so is inherently
insecure. Instead we use SSH with RSA keys to allow secure passwordless access.
Note, this only made SSH authentication passwordless, both router passwords
remain in place.

\section{Traffic Management}
In order to simulate a real world situation, traffic entering and leaving our
network needs to be managed. In order to demonstrate this, AS 42 has been setup
to be our provider, whilst DT and Sky are setup as peers to our ISP.

As AS 42 is
setup to be our provider, they should be able to see routes to our network
and to our peers' networks. In order to do this, our prefix (\texttt
{12.0.0.0/8}) and our peers'
prefixes, Sky and DT (\texttt{8.0.0.0/8} and \texttt{34.0.0.0/8} respectively),
are advertised to it.

In order to perform this filter, an access list is defined on Alpha to
match all routes that do not belong to the prefix of \texttt{10.0.0.0/8}, i.e.
routes not local to AS 42. A route map is then used to tag these routes with the
well known community tag no-export. What this will do is stop the router from
advertising routes to anything that is not on our provider's network.

As Sky and DT are setup to be peers to our ISP, they
should be able to access our network but will not be able to access each other
through us. In a real world situation, our peers should not be able to access
our provider through us but we have been advised, and also for the sake of
providing our peers redundancy if their link to AS 42 is disrupted, to allow
them to access our provider through our network. In order for this to work,
only the \texttt{10.0.0.0/8} and \texttt{12.0.0.0/8} prefixes are advertised to
our peers. This will allow the peers to see routes to our network and AS
42, but not each other.


Similar access lists to Alpha have been defined on Bravo and Charlie in order to
only advertise prefixes to routes local to our peers. Bravo is connected to Sky,
so routes not on the \texttt{8.0.0.0/8} prefix is tagged with the community tag
no-export. Charlie is connected to DT, so it tags routes not on the
\texttt{34.0.0.0/8} prefix with the community tag no-export. As our peers are
not allowed to communicate with each other through us, we also had to define
prefix lists on Bravo and Charlie. As they are both allowed to access our
network and our provider, prefix lists were created to permit the
\texttt{10.0.0.0/8} to \texttt{10.0.0.0/32} prefixes and the \texttt{12.0.0.0/8}
to \texttt{12.0.0.0/32} prefixes. This will set the routers to only advertise
our network and our provider's network to our peers.

In summary:

\begin{itemize}
    \item Alpha advertises all prefixes to routes local to our provider
    (\texttt{10.0.0.0/8})

    \item Bravo advertises our prefixes (\texttt{12.0.0.0/8} to \texttt
    {12.0.0.0/32}) and our  provider's prefixes (\texttt{10.0.0.0/8} to
    \texttt{10.0.0.0/32}) to routes local to Sky (\texttt{8.0.0.0/8})

    \item Charlie advertises our prefixes (\texttt{12.0.0.0/8} to \texttt
    {12.0.0.0/32}) and our provider's prefixes (\texttt{10.0.0.0/8} to \texttt
    {10.0.0.0/32}) to routes local to DT (\texttt{34.0.0.0/8})
\end{itemize}